require 'test_helper'

class PlaintextTest < Minitest::Test
  def test_that_it_has_a_version_number
    refute_nil ::Plaintext::VERSION
  end

  def test_registration
    puts '~) Registration OPAQUE Via Ruby ~)'
    alpha = [226, 35, 157, 8, 63, 97, 171, 99, 69, 189, 159, 141, 180, 4, 203, 46, 116, 119, 130, 203, 210, 2, 185, 200, 136, 149, 83, 102, 196, 13, 109, 9]
    beta, v, pub_s = Plaintext::Registration.start('barry', alpha)

    puts '=> Registration Finalization'
    pub_u = [205, 174, 154, 148, 138, 21, 142, 98, 102, 212, 171, 21, 75, 131, 129, 188, 131, 83, 38, 74, 55, 0, 75, 190, 50, 189, 47, 107, 235, 246, 92, 85]
    puts pub_u.size
    envelope_reg = [196, 242, 45, 186, 240, 196, 70, 205, 94, 21, 77, 237, 22, 49, 251, 73, 174, 210, 200, 194, 199, 169, 89, 211, 131, 55, 55, 80, 178, 174, 75, 231, 17, 64, 84, 25, 177, 110, 23, 17, 220, 32, 161, 243, 76, 170, 71, 66, 131, 240, 105, 32, 111, 74, 127, 232, 180, 92, 204, 103, 155, 190, 247, 249, 93, 139, 23, 179, 39, 229, 170, 14, 5, 25, 250, 104, 164, 144, 187, 174, 68, 211, 10, 70, 232, 25, 157, 177, 236, 219, 119, 119, 14, 80, 52, 106, 147, 182, 58, 108, 183, 116, 183, 37, 71, 252, 47, 84, 237, 223, 76, 115]
    puts envelope_reg.size
    Plaintext::Registration.finalize('barry', pub_u, envelope_reg)

    puts '~) Authenticating OPAQUE Via Ruby ~)'
    alpha = [142, 135, 61, 248, 178, 203, 86, 140, 221, 69, 98, 1, 123, 239, 208, 228, 127, 152, 164, 171, 25, 254, 202, 205, 243, 174, 229, 245, 118, 46, 39, 14]
    key = [182, 211, 247, 22, 251, 171, 209, 121, 26, 41, 7, 0, 202, 103, 82, 151, 112, 232, 227, 123, 91, 177, 83, 137, 81, 203, 176, 202, 69, 76, 129, 96]
    beta, v, envelope, key, y = Plaintext::Authentication.start('barry', alpha, key)

    assert_equal(envelope_reg, envelope)

    key = [118, 42, 51, 187, 226, 136, 108, 19, 178, 151, 29, 197, 229, 153, 204, 173, 28, 212, 54, 214, 121, 92, 101, 54, 133, 124, 118, 122, 185, 11, 202, 191, 176, 148, 177, 154, 154, 233, 131, 18, 12, 137, 35, 224, 14, 120, 242, 106, 165, 133, 208, 196, 131, 70, 39, 65, 103, 76, 29, 23, 128, 206, 153, 45, 23, 48, 232, 174, 83, 97, 191, 52, 53, 39, 59, 95, 138, 132, 26, 22, 171, 153, 240, 52, 213, 106, 192, 54, 181, 32, 41, 170, 134, 53, 84, 239, 98, 36, 58, 175, 140, 170, 123, 168, 186, 171, 143, 172, 7, 184, 18, 104, 30, 103, 31, 44, 188, 234, 137, 202, 115, 35, 239, 79, 43, 226, 54, 20, 75, 33, 183, 205, 130, 95, 255, 56, 196, 27, 70, 144, 202, 250, 150, 149, 132, 89, 105, 118, 29, 15, 16, 131, 40, 135, 45, 99, 163, 155, 188, 81, 215, 43, 74, 87, 23, 84, 55, 248, 26, 61, 203, 162, 221, 10, 31, 108, 228, 48, 171, 168, 207, 196, 39, 47, 173, 100, 167, 166, 236, 151, 164, 193]
    puts key.size
    x = [182, 211, 247, 22, 251, 171, 209, 121, 26, 41, 7, 0, 202, 103, 82, 151, 112, 232, 227, 123, 91, 177, 83, 137, 81, 203, 176, 202, 69, 76, 129, 96]
    puts x.size
    Plaintext::Authentication.finalize('barry', key, x)
  end

  def test_generating_totp
    skip('qr')
    puts '~)- Ruby Land ~)-'
    puts Plaintext::AuthN.generate_qr('user 12')
  end
end
